# VibeTrans 代码耦合检查脚本

## 概述

`test-code-coupling.js` 是一个专为 VibeTrans 项目设计的代码耦合检查工具，用于检测项目中的各种耦合问题，确保代码质量和结构的一致性。

## 功能特性

### 1. JSON文件与页面耦合检查
- ✅ 检查 `messages/pages/` 下的JSON文件是否与 `src/app/[locale]/(marketing)/(pages)/` 下的页面文件对应
- ✅ 验证翻译文件路径是否正确
- ✅ 检查缺失的JSON文件或页面文件
- ✅ 双向检查确保完整性

### 2. 组件导入路径检查
- ✅ 检查组件的import路径是否正确
- ✅ 验证文件是否存在
- ✅ 支持相对路径和绝对路径（@/别名）检查
- ✅ 智能跳过静态资源文件（图片、CSS等）

### 3. 翻译键引用检查
- ✅ 检查页面组件中使用的翻译键是否在对应的JSON文件中存在
- ✅ 验证翻译键的完整性
- ✅ 智能限制输出数量，避免信息过载

### 4. 路由和文件结构匹配检查
- ✅ 检查URL路径是否与文件结构匹配
- ✅ 验证动态路由参数
- ✅ 检查命名规范（kebab-case）

## 使用方法

### 基本用法

```bash
# 在项目根目录运行
node test-code-coupling.js
```

### 输出说明

脚本会生成详细的检查报告，包含以下信息：

- **❌ 错误**：必须修复的问题
- **⚠️ 警告**：建议修复的问题
- **💡 建议**：改进建议

## 检查结果示例

```
🔍 VibeTrans 代码耦合检查开始...

📋 检查 JSON 文件与页面耦合...
✅ JSON文件与页面耦合检查完成

🔗 检查组件导入路径...
✅ 组件导入路径检查完成

🌐 检查翻译键引用...
✅ 翻译键引用检查完成

🛣️  检查路由和文件结构匹配...
✅ 路由和文件结构匹配检查完成

📊 生成检查报告...

============================================================
🔍 VibeTrans 代码耦合检查报告
============================================================

❌ 错误 (2):
  1. 缺失英文翻译文件: /path/to/messages/pages/example/en.json
  2. 无效的导入路径: /path/to/file.tsx 导入 ./MissingComponent

⚠️  警告 (1):
  1. 缺失中文翻译文件: /path/to/messages/pages/example/zh.json

💡 建议 (0):
  ✅ 无改进建议

📈 总结: 发现 3 个问题 (2 错误, 1 警告)
```

## 常见问题及解决方案

### 1. 缺失翻译文件

**问题**：`缺失英文翻译文件: messages/pages/example/en.json`

**解决方案**：
- 确保在 `messages/pages/[工具名]/` 目录下创建 `en.json` 和 `zh.json` 文件
- 参考现有工具的JSON结构

### 2. 无效的导入路径

**问题**：`无效的导入路径: src/components/Example.tsx 导入 ./MissingComponent`

**解决方案**：
- 检查文件路径是否正确
- 确认目标文件是否存在
- 检查文件扩展名

### 3. 缺失的翻译键

**问题**：`缺失的翻译键: example/tool.title`

**解决方案**：
- 在对应的JSON文件中添加缺失的翻译键
- 确保键名与代码中使用的一致

## 脚本配置

脚本默认使用以下路径配置：

```javascript
this.paths = {
  messagesDir: path.join(this.projectRoot, 'messages'),
  pagesDir: path.join(this.projectRoot, 'src/app/[locale]/(marketing)/(pages)'),
  srcDir: path.join(this.projectRoot, 'src'),
  componentsDir: path.join(this.projectRoot, 'src/components')
};
```

如需修改路径，可以编辑脚本中的配置部分。

## 最佳实践

1. **定期运行**：在提交代码前运行检查
2. **修复优先级**：优先修复错误，然后处理警告
3. **保持一致性**：确保所有翻译工具都遵循相同的文件结构
4. **及时更新**：添加新功能时同步更新翻译文件

## 注意事项

- 脚本会跳过备份文件（如 `page-original-backup.tsx`）
- 静态资源文件（图片、CSS等）不会进行导入路径检查
- 翻译键检查限制每个文件最多显示10个错误，避免输出过长

## 技术实现

- 使用 Node.js 文件系统API进行文件检查
- 正则表达式匹配导入语句和翻译键
- 递归遍历目录结构
- 智能过滤和分类错误信息

## 贡献

如需改进脚本功能，可以：

1. 修改 `test-code-coupling.js` 文件
2. 添加新的检查规则
3. 优化错误报告格式
4. 提升检查性能

---

**维护者**：VibeTrans 开发团队
**最后更新**：2025年10月21日